<?xml version="1.0" encoding="utf-8"?>

<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:strings="clr-namespace:UltimateVideoBrowser.Resources.Strings"
             x:Class="UltimateVideoBrowser.Views.SettingsPage"
             BackgroundColor="{DynamicResource AppBg}"
             Title="{x:Static strings:AppResources.SettingsPageTitle}">

    <Grid RowDefinitions="Auto,*"
          Padding="{OnPlatform Android='12,32,12,12', iOS='12,24,12,12', Default='12'}">
        <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
            <Button x:Name="BackButton"
                    Text="{x:Static strings:AppResources.BackButton}"
                    Clicked="OnBackClicked" />
            <Label Grid.Column="1"
                   Text="{x:Static strings:AppResources.SettingsPageHeader}"
                   TextColor="{DynamicResource OnSurface}"
                   FontAttributes="Bold"
                   FontSize="16" />
        </Grid>

        <ScrollView Grid.Row="1" Margin="0,12,0,0">
            <VerticalStackLayout Spacing="12">
                <Frame BackgroundColor="{DynamicResource Surface}"
                       CornerRadius="14"
                       Padding="14">
                    <VerticalStackLayout Spacing="12">
                        <Label Text="{x:Static strings:AppResources.SettingsAppearanceTitle}"
                               FontAttributes="Bold"
                               TextColor="{DynamicResource OnSurface}" />
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                            <Label Text="{x:Static strings:AppResources.SettingsThemeLabel}"
                                   TextColor="{DynamicResource OnSurfaceMuted}"
                                   VerticalOptions="Center" />
                            <Picker Grid.Column="1"
                                    ItemsSource="{Binding ThemeOptions}"
                                    ItemDisplayBinding="{Binding Display}"
                                    SelectedItem="{Binding SelectedTheme}"
                                    TextColor="{DynamicResource OnSurface}"
                                    BackgroundColor="{DynamicResource Surface2}"
                                    Title="{x:Static strings:AppResources.SettingsThemeLabel}"
                                    WidthRequest="160" />
                        </Grid>
                    </VerticalStackLayout>
                </Frame>

                <Frame BackgroundColor="{DynamicResource Surface}"
                       CornerRadius="14"
                       Padding="14">
                    <VerticalStackLayout Spacing="12">
                        <Label Text="{x:Static strings:AppResources.SettingsSortingTitle}"
                               FontAttributes="Bold"
                               TextColor="{DynamicResource OnSurface}" />
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                            <Label Text="{x:Static strings:AppResources.SettingsDefaultSortLabel}"
                                   TextColor="{DynamicResource OnSurfaceMuted}"
                                   VerticalOptions="Center" />
                            <Picker Grid.Column="1"
                                    ItemsSource="{Binding SortOptions}"
                                    ItemDisplayBinding="{Binding Display}"
                                    SelectedItem="{Binding SelectedSortOption}"
                                    TextColor="{DynamicResource OnSurface}"
                                    BackgroundColor="{DynamicResource Surface2}"
                                    Title="{x:Static strings:AppResources.SettingsDefaultSortLabel}"
                                    WidthRequest="160" />
                        </Grid>
                    </VerticalStackLayout>
                </Frame>

                <Frame BackgroundColor="{DynamicResource Surface}"
                       CornerRadius="14"
                       Padding="14">
                    <VerticalStackLayout Spacing="12">
                        <Label Text="{x:Static strings:AppResources.SettingsPlaybackTitle}"
                               FontAttributes="Bold"
                               TextColor="{DynamicResource OnSurface}" />
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                            <Label Text="{x:Static strings:AppResources.SettingsInternalPlayerLabel}"
                                   TextColor="{DynamicResource OnSurfaceMuted}"
                                   VerticalOptions="Center" />
                            <Switch Grid.Column="1"
                                    IsToggled="{Binding IsInternalPlayerEnabled}" />
                        </Grid>
                    </VerticalStackLayout>
                </Frame>

                <Frame BackgroundColor="{DynamicResource Surface}"
                       CornerRadius="14"
                       Padding="14">
                    <VerticalStackLayout Spacing="8">
                        <Label Text="{x:Static strings:AppResources.SettingsFileChangesTitle}"
                               FontAttributes="Bold"
                               TextColor="{DynamicResource OnSurface}" />
                        <Label Text="{x:Static strings:AppResources.SettingsFileChangesHint}"
                               FontSize="12"
                               TextColor="{DynamicResource OnSurfaceMuted}" />
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                            <Label Text="{x:Static strings:AppResources.SettingsFileChangesLabel}"
                                   TextColor="{DynamicResource OnSurfaceMuted}"
                                   VerticalOptions="Center" />
                            <Switch Grid.Column="1"
                                    IsToggled="{Binding AllowFileChanges}" />
                        </Grid>
                    </VerticalStackLayout>
                </Frame>

                <Frame BackgroundColor="{DynamicResource Surface}"
                       CornerRadius="14"
                       Padding="14">
                    <VerticalStackLayout Spacing="8">
                        <Label Text="{x:Static strings:AppResources.SettingsPeopleTaggingTitle}"
                               FontAttributes="Bold"
                               TextColor="{DynamicResource OnSurface}" />
                        <Label Text="{x:Static strings:AppResources.SettingsPeopleTaggingHint}"
                               FontSize="12"
                               TextColor="{DynamicResource OnSurfaceMuted}" />
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                            <Label Text="{x:Static strings:AppResources.SettingsPeopleTaggingLabel}"
                                   TextColor="{DynamicResource OnSurfaceMuted}"
                                   VerticalOptions="Center" />
                            <Switch Grid.Column="1"
                                    IsToggled="{Binding IsPeopleTaggingEnabled}" />
                        </Grid>

                        <!-- Model status & download helper for automatic face recognition -->
                        <BoxView HeightRequest="1"
                                 BackgroundColor="{DynamicResource BorderSubtle}"
                                 Margin="0,8,0,0" />

                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                            <Label Text="{x:Static strings:AppResources.SettingsPeopleModelsStatusLabel}"
                                   TextColor="{DynamicResource OnSurfaceMuted}"
                                   VerticalOptions="Center" />
                            <Label Grid.Column="1"
                                   Text="{Binding PeopleModelsStatusText}"
                                   TextColor="{DynamicResource OnSurface}"
                                   VerticalOptions="Center"
                                   HorizontalTextAlignment="End" />
                        </Grid>

                        <Label Text="{Binding PeopleModelsDetailText}"
                               FontSize="12"
                               LineBreakMode="WordWrap"
                               TextColor="{DynamicResource OnSurfaceMuted}" />

                        <Button Text="{x:Static strings:AppResources.SettingsPeopleModelsDownloadButton}"
                                Command="{Binding DownloadPeopleModelsCommand}"
                                IsEnabled="{Binding CanDownloadPeopleModels}"
                                IsVisible="{Binding CanDownloadPeopleModels}"
                                BackgroundColor="{DynamicResource Surface2}"
                                TextColor="{DynamicResource OnSurface}" />
                    </VerticalStackLayout>
                </Frame>

                <Frame BackgroundColor="{DynamicResource Surface}"
                       CornerRadius="14"
                       Padding="14">
                    <VerticalStackLayout Spacing="12">
                        <Label Text="{x:Static strings:AppResources.SettingsFilterTitle}"
                               FontAttributes="Bold"
                               TextColor="{DynamicResource OnSurface}" />
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                            <Label Text="{x:Static strings:AppResources.SettingsDateFilterLabel}"
                                   TextColor="{DynamicResource OnSurfaceMuted}"
                                   VerticalOptions="Center" />
                            <Switch Grid.Column="1"
                                    IsToggled="{Binding IsDateFilterEnabled}" />
                        </Grid>
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12" RowDefinitions="Auto,Auto" RowSpacing="8">
                            <Label Text="{x:Static strings:AppResources.SettingsDateFromLabel}"
                                   TextColor="{DynamicResource OnSurfaceMuted}"
                                   VerticalOptions="Center" />
                            <DatePicker Grid.Column="1"
                                        Date="{Binding DateFilterFrom}"
                                        IsEnabled="{Binding IsDateFilterEnabled}"
                                        TextColor="{DynamicResource OnSurface}" />
                            <Label Grid.Row="1"
                                   Text="{x:Static strings:AppResources.SettingsDateToLabel}"
                                   TextColor="{DynamicResource OnSurfaceMuted}"
                                   VerticalOptions="Center" />
                            <DatePicker Grid.Row="1"
                                        Grid.Column="1"
                                        Date="{Binding DateFilterTo}"
                                        IsEnabled="{Binding IsDateFilterEnabled}"
                                        TextColor="{DynamicResource OnSurface}" />
                        </Grid>
                    </VerticalStackLayout>
                </Frame>

                <Frame BackgroundColor="{DynamicResource Surface}"
                       CornerRadius="14"
                       Padding="14">
                    <VerticalStackLayout Spacing="8">
                        <Label Text="{x:Static strings:AppResources.SettingsLocationsTitle}"
                               FontAttributes="Bold"
                               TextColor="{DynamicResource OnSurface}" />
                        <Label Text="{x:Static strings:AppResources.SettingsLocationsHint}"
                               FontSize="12"
                               TextColor="{DynamicResource OnSurfaceMuted}" />
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                            <Label Text="{x:Static strings:AppResources.SettingsLocationsLabel}"
                                   TextColor="{DynamicResource OnSurfaceMuted}"
                                   VerticalOptions="Center" />
                            <Switch Grid.Column="1"
                                    IsToggled="{Binding IsLocationEnabled}" />
                        </Grid>
                    </VerticalStackLayout>
                </Frame>

                <Frame BackgroundColor="{DynamicResource Surface}"
                       CornerRadius="14"
                       Padding="14">
                    <VerticalStackLayout Spacing="12">
                        <Label Text="{x:Static strings:AppResources.SettingsMediaTypesTitle}"
                               FontAttributes="Bold"
                               TextColor="{DynamicResource OnSurface}" />
                        <Label Text="{x:Static strings:AppResources.SettingsMediaTypesMessage}"
                               FontSize="12"
                               TextColor="{DynamicResource OnSurfaceMuted}" />
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                            <Label Text="{x:Static strings:AppResources.MediaTypeVideos}"
                                   TextColor="{DynamicResource OnSurfaceMuted}"
                                   VerticalOptions="Center" />
                            <Switch Grid.Column="1"
                                    IsToggled="{Binding IsVideosIndexed}" />
                        </Grid>
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                            <Label Text="{x:Static strings:AppResources.MediaTypePhotos}"
                                   TextColor="{DynamicResource OnSurfaceMuted}"
                                   VerticalOptions="Center" />
                            <Switch Grid.Column="1"
                                    IsToggled="{Binding IsPhotosIndexed}" />
                        </Grid>
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                            <Label Text="{x:Static strings:AppResources.MediaTypeGraphics}"
                                   TextColor="{DynamicResource OnSurfaceMuted}"
                                   VerticalOptions="Center" />
                            <Switch Grid.Column="1"
                                    IsToggled="{Binding IsGraphicsIndexed}" />
                        </Grid>
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                            <Label Text="{x:Static strings:AppResources.MediaTypeDocuments}"
                                   TextColor="{DynamicResource OnSurfaceMuted}"
                                   VerticalOptions="Center" />
                            <Switch Grid.Column="1"
                                    IsToggled="{Binding IsDocumentsIndexed}" />
                        </Grid>
                        <Label Text="{x:Static strings:AppResources.SettingsExtensionsTitle}"
                               FontAttributes="Bold"
                               TextColor="{DynamicResource OnSurface}"
                               Margin="0,4,0,0" />
                        <Label Text="{x:Static strings:AppResources.SettingsExtensionsHint}"
                               FontSize="12"
                               TextColor="{DynamicResource OnSurfaceMuted}" />
                        <!--
                            This grid uses Grid.Row 0..2. Without RowDefinitions, MAUI will place
                            all children into a single row which causes controls to overlap.
                        -->
                        <Grid ColumnDefinitions="Auto,*"
                              RowDefinitions="Auto,Auto,Auto"
                              ColumnSpacing="12"
                              RowSpacing="8">
                            <Label Text="{x:Static strings:AppResources.MediaTypeVideos}"
                                   TextColor="{DynamicResource OnSurfaceMuted}"
                                   VerticalOptions="Center" />
                            <Entry Grid.Column="1"
                                   Text="{Binding VideoExtensionsText}"
                                   Placeholder="{x:Static strings:AppResources.SettingsExtensionsPlaceholder}"
                                   TextColor="{DynamicResource OnSurface}"
                                   HorizontalOptions="FillAndExpand"
                                   BackgroundColor="{DynamicResource Surface2}" />
                            <Label Grid.Row="1"
                                   Text="{x:Static strings:AppResources.MediaTypePhotos}"
                                   TextColor="{DynamicResource OnSurfaceMuted}"
                                   VerticalOptions="Center" />
                            <Entry Grid.Row="1"
                                   Grid.Column="1"
                                   Text="{Binding PhotoExtensionsText}"
                                   Placeholder="{x:Static strings:AppResources.SettingsExtensionsPlaceholder}"
                                   TextColor="{DynamicResource OnSurface}"
                                   HorizontalOptions="FillAndExpand"
                                   BackgroundColor="{DynamicResource Surface2}" />
                            <Label Grid.Row="2"
                                   Text="{x:Static strings:AppResources.MediaTypeDocuments}"
                                   TextColor="{DynamicResource OnSurfaceMuted}"
                                   VerticalOptions="Center" />
                            <Entry Grid.Row="2"
                                   Grid.Column="1"
                                   Text="{Binding DocumentExtensionsText}"
                                   Placeholder="{x:Static strings:AppResources.SettingsExtensionsPlaceholder}"
                                   TextColor="{DynamicResource OnSurface}"
                                   HorizontalOptions="FillAndExpand"
                                   BackgroundColor="{DynamicResource Surface2}" />
                        </Grid>
                    </VerticalStackLayout>
                </Frame>

                <Frame BackgroundColor="{DynamicResource Surface}"
                       CornerRadius="14"
                       Padding="14">
                    <VerticalStackLayout Spacing="12">
                        <Label Text="{x:Static strings:AppResources.SettingsIndexingTitle}"
                               FontAttributes="Bold"
                               TextColor="{DynamicResource OnSurface}" />
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                            <Label Text="{x:Static strings:AppResources.SettingsReindexLabel}"
                                   TextColor="{DynamicResource OnSurfaceMuted}"
                                   VerticalOptions="Center" />
                            <Switch Grid.Column="1"
                                    IsToggled="{Binding NeedsReindex}" />
                        </Grid>
                        <Label Text="{x:Static strings:AppResources.SettingsDatabaseResetHint}"
                               TextColor="{DynamicResource OnSurfaceMuted}" />
                        <Button Text="{x:Static strings:AppResources.SettingsDatabaseResetButton}"
                                Command="{Binding ResetDatabaseCommand}"
                                IsEnabled="{Binding IsDatabaseResetting, Converter={StaticResource InverseBoolConverter}}"
                                HorizontalOptions="Start"
                                Padding="16,6" />
                    </VerticalStackLayout>
                </Frame>

                <Frame BackgroundColor="{DynamicResource Surface}"
                       CornerRadius="14"
                       Padding="14">
                    <VerticalStackLayout Spacing="12">
                        <Label Text="{x:Static strings:AppResources.ErrorLogTitle}"
                               FontAttributes="Bold"
                               TextColor="{DynamicResource OnSurface}" />
                        <Label Text="{x:Static strings:AppResources.ErrorLogHint}"
                               FontSize="12"
                               TextColor="{DynamicResource OnSurfaceMuted}" />
                        <Label Text="{Binding ErrorLogPath}"
                               FontSize="11"
                               TextColor="{DynamicResource OnSurfaceMuted}" />
                        <Grid ColumnDefinitions="Auto,Auto"
                              ColumnSpacing="12">
                            <Button Text="{x:Static strings:AppResources.ErrorLogShowButton}"
                                    Command="{Binding ShowErrorLogCommand}"
                                    HorizontalOptions="Start"
                                    Padding="16,6" />
                            <Button Grid.Column="1"
                                    Text="{x:Static strings:AppResources.ErrorLogShareButton}"
                                    Command="{Binding ShareErrorLogCommand}"
                                    HorizontalOptions="Start"
                                    Padding="16,6" />
                        </Grid>
                        <Button Text="{x:Static strings:AppResources.ErrorLogClearButton}"
                                Command="{Binding ClearErrorLogCommand}"
                                HorizontalOptions="Start"
                                Padding="16,6" />
                    </VerticalStackLayout>
                </Frame>
            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>
